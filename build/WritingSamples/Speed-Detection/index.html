<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-WritingSamples/Speed-Detection">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<title data-rh="true">Speed-Detection | Chris Navarro</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chrisnavarro.io/WritingSamples/Speed-Detection"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Speed-Detection | Chris Navarro"><meta data-rh="true" name="description" content="Project Overview"><meta data-rh="true" property="og:description" content="Project Overview"><link data-rh="true" rel="canonical" href="https://chrisnavarro.io/WritingSamples/Speed-Detection"><link data-rh="true" rel="alternate" href="https://chrisnavarro.io/WritingSamples/Speed-Detection" hreflang="en"><link data-rh="true" rel="alternate" href="https://chrisnavarro.io/WritingSamples/Speed-Detection" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b25e4b0a.css">
<link rel="preload" href="/assets/js/runtime~main.5bed5e08.js" as="script">
<link rel="preload" href="/assets/js/main.ccb2c8d8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Chris Navarro</b></a><a href="https://www.linkedin.com/in/chrisnswe/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lvllvl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">About</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/projectList">Project List</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/WritingSamples/Speed-Detection">Documentation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/WritingSamples/Speed-Detection">Speed-Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/WritingSamples/Leetcode Solution">Leetcode Solution</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Documentation</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Speed-Detection</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Speed-Detection</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="project-overview">Project Overview<a class="hash-link" href="#project-overview" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="project-workflow">Project Workflow<a class="hash-link" href="#project-workflow" title="Direct link to heading">‚Äã</a></h4><p>We will begin with a video in <code>mp4</code> format. The video contains dash cam footage
of a vehicle driving in downtown San Francisco. Our goal is to predict the
speed of the car at each frame ( 20, 400 total ).</p><p>Our workflow will be as follows: </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">- Video -&gt; 20,400 images -&gt; Segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Segmentation -&gt; optical flow matrix set </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Segmentation -&gt; one hot encoding matrix set </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Combine one hot encoding with optical flow </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Long Short Term Memory ( LSTM ) model </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="preparing-the-dataset">Preparing the dataset<a class="hash-link" href="#preparing-the-dataset" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="segmentation"><ins>Segmentation</ins><a class="hash-link" href="#segmentation" title="Direct link to heading">‚Äã</a></h4><p>After separating the video into 20,400 images we will process each image through segmentation.</p><p>Segmentation is a form of image classification. A typical image classifier has
a set number of classes. For example we can make a binary classifier that
distinguishes between Adam Sandler or Brad Pitt. Our classifier will label an image as Adam Sandler if it thinks the entire image resembles Adam Sandler. Likewise with Brad Pitt. </p><p align="center"><img loading="lazy" width="460" height="300" src="../../images/AdamBradTogether.jpg" class="img_E7b_"></p><p>But what if the image contains both Brad Pitt <em>and</em> Adam Sandler? How should the
image classifier categorize the image? Segmentation is a way to work around
this problem. This technique anticipates that both our classes ( Brad Pitt and
Adam Sandler ) may be in an image at the same time and therefore approaches
classification differently. Instead of classifying an <em>entire</em> image as Brad or Adam,
segmentation classifies each pixel as either Adam or Brad. </p><p align="center"><img loading="lazy" width="460" height="300" src="../../images/SegmentationFastai.png" class="img_E7b_"></p><p>So taking the information we gleaned from the Brad and Adam example, let&#x27;s apply it to our current image set. We have driving footage so we need to figure out a way to categorize each object that appears in our images. <a href="https://medium.com/analytics-vidhya/image-segmentation-using-fastai-ddded25f811e" target="_blank" rel="noopener noreferrer">Fast.Ai</a> created a segmentation model with the following 31 classes below: </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">classes = [ &#x27;Animal&#x27;, &#x27;Archway&#x27;, &#x27;Bicyclist&#x27;, &#x27;Building&#x27;, &#x27;Car&#x27;, &#x27;CartLuggagePram&#x27;, &#x27;Child&#x27;, &#x27;Column_Pole&#x27;, &#x27;Fence&#x27;, &#x27;LaneMkgsDriv&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;LaneMkgsNonDriv&#x27;, &#x27;Misc_Text&#x27;, &#x27;MotorcycleScooter&#x27;, &#x27;OtherMoving&#x27;, &#x27;ParkingBlock&#x27;, &#x27;Pedestrian&#x27;, &#x27;Road&#x27;, &#x27;RoadShoulder&#x27;, &#x27;Sidewalk&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;SignSymbol&#x27;, &#x27;Sky&#x27;, &#x27;SUVPickupTruck&#x27;, &#x27;TrafficCone&#x27;, &#x27;TrafficLight&#x27;, &#x27;Train&#x27;, &#x27;Tree&#x27;, &#x27;Truck_bus&#x27;, &#x27;Tunnel&#x27;, &#x27;VegetagtionMisc&#x27;, &#x27;Void&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Wall&#x27; ] </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Once the image is segmented each of the 31 classes are represented in two ways. If the image is in matrix format the class is shown as a number ( e.g., 0 - 30 ), and in image format we differentiate classes by color ( e.g., sidewalks are purple, buildings are orange ). </p><p>Segmenting all our images will allow us to implement other techniques that will
help us detect the speed at each frame. From this point we will create two sets of our segmentation image set. One for our optical flow processing and the other for our one hot encoding processing. </p><h4 class="anchor anchorWithStickyNavbar_mojV" id="optical-flow"><ins>Optical Flow</ins><a class="hash-link" href="#optical-flow" title="Direct link to heading">‚Äã</a></h4><table><tr><th> dash cam footage </th><th> optical flow example </th></tr><tr><td> <img loading="lazy" src="../../images/dash_cam.gif" class="img_E7b_"></td><td><img loading="lazy" src="../../images/optical_flow_2.gif" class="img_E7b_"></td></tr></table><p>Optical flow is a computer vision tool used for sequential data. In our case
we&#x27;re using it to track any movement from image to image. This allows us to see
which of our classes ( pedestrians, street signs ) are moving through
our sequence of images. </p><p>Let&#x27;s imagine again our image as a matrix. Our matrix has dimensions of <strong>20 x
30</strong>. Optical flow uses small filters ( i.e., a smaller matrix, usually <strong>3 x 3</strong> or
<strong>5 x 5</strong> ) that hovers over every part of the <strong>20 x 30</strong> matrix and identifies
small dense clusters of similar pixels and then compares it to the next
matrix in the sequence. </p><p>Visually this ends up looking like the image above on the right, only movement is
tracked. Comparing the optical flow gif to the video frame gif on the left we
can see that lane markings are being picked up by the optical flow model!
That&#x27;s great news for us because we want to give our LSTM model an object to
reference so that it can develop a speed estimate for each frame. </p><p>For more information and an implementation of optical flow check <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_video/py_lucas_kanade/py_lucas_kanade.html" target="_blank" rel="noopener noreferrer">this</a> out.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="one-hot-encoding"><ins>One Hot Encoding</ins><a class="hash-link" href="#one-hot-encoding" title="Direct link to heading">‚Äã</a></h4><p align="center"><img loading="lazy" width="460" height="300" src="../../images/SegmentationFastai.png" class="img_E7b_"></p><p>Recall our segmented image example, we have 31 classes total. Our original video is 17 minutes of driving. All 31 classes are not always present in the frame. For example sometimes there are buildings present and other times there are not. </p><p>There is another way of communicating that fact. In matrix form an image may be size <strong>1 x W x H</strong> where <strong>W</strong> = width, <strong>H</strong> = height, and 1 = the number of layers in the matrix. Each pixel is labeled for its corresponding class, but how do we know if a class is not present in the image?</p><p>One hot encoding helps display that information. Instead of representing our classes as individual pixels, each class is represented as an individual layer. If the class is not present in the image, the entire layer is filled with 0&#x27;s. If the class is present, there are 1&#x27;s wherever the class object is located and 0&#x27;s everywhere else. In the one hot encoding matrix our new dimensions are now <strong>30 x W x H</strong>. </p><p>As an example, if we wanted to check if there were any buildings in our image we could look at layer 3 of our one hot encoded matrix. </p><p><a href="https://www.jeremyjordan.me/content/images/2018/05/Screen-Shot-2018-05-16-at-9.36.00-PM.png" target="_blank" rel="noopener noreferrer">Jeremy Jordan</a> has created a great illustration of this concept, shown below. </p><p align="center"><img loading="lazy" width="660" height="400" src="../../images/oneHotExample.png" class="img_E7b_"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="combining-one-hot-with-optical-flow"><ins>Combining One Hot with Optical Flow</ins><a class="hash-link" href="#combining-one-hot-with-optical-flow" title="Direct link to heading">‚Äã</a></h4><p>Optical flow preserves the direction of each object. If the optical flow shows that the car is moving towards a building then when we apply matrix multiplication of optical flow and one hot matrices we preserve that movement information. Since our one hot matrix tells us when something is not in an image, when we apply matrix multiplication any optical flow movement at that area will be considered insignificant and will be rendered as 0. </p><p>In the next post we&#x27;ll insert these matrices into our LSTM model.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lvllvl/portal2.git/docs/WritingSamples/Speed-Detection.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/projectList"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Project List</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/WritingSamples/Leetcode Solution"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Leetcode Solution</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview" class="table-of-contents__link toc-highlight">Project Overview</a></li><li><a href="#preparing-the-dataset" class="table-of-contents__link toc-highlight">Preparing the dataset</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.5bed5e08.js"></script>
<script src="/assets/js/main.ccb2c8d8.js"></script>
</body>
</html>